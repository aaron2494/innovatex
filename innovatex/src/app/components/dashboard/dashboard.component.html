<div class="grafico-container">
  <div class="grafico-pastel">
    <canvas baseChart
      [data]="chartData"
      [type]="'pie'"
      [options]="chartOptions">
    </canvas>
  </div>
  <div class="grafico-descripcion">
    <h3>游늵 Distribuci칩n de planes contratados</h3>
    <p>
      Este gr치fico de torta refleja el porcentaje de clientes que han adquirido cada uno de nuestros planes: <strong>B치sico</strong>, <strong>Profesional</strong> y <strong>Premium</strong>.
    </p>
    <p>
      Nos permite visualizar qu칠 soluciones est치n siendo m치s demandadas, ayud치ndonos a enfocar nuestras estrategias y seguir innovando en funci칩n de las necesidades de nuestros clientes.
    </p>
  </div>
</div>

<div class="container mt-4">

  <button class="btn btn-primary mb-3" (click)="mostrarDashboard = !mostrarDashboard">
    {{ mostrarDashboard ? 'Ocultar Dashboard' : 'Mostrar Dashboard' }}
  </button>

  <div 
    [@expansion]="mostrarDashboard ? 'visible' : 'oculto'" 
    style="overflow: hidden;" 
    *ngIf="mostrarDashboard || cargando || error"
  >

    <h2 class="mb-4">Dashboard de Pagos</h2>

    <div *ngIf="cargando" class="text-center">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
      <p>Cargando transacciones...</p>
    </div>

    <div *ngIf="error" class="alert alert-danger">
      {{ error }}
    </div>

    <div *ngIf="!cargando && ventas.length === 0 && !error" class="alert alert-info">
      No hay transacciones para mostrar.
    </div>

    <div *ngIf="ventas.length > 0">
      <div class="table-responsive">
        <table class="table table-striped table-hover">
          <thead class="table-dark">
            <tr>
              <th>ID Transacci칩n</th>
              <th>Fecha</th>
              <th>Cliente</th>
              <th>Plan</th>
              <th>Monto</th>
              <th>M칠todo de Pago</th>
              <th>Estado</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let venta of ventas">
              <td>{{ venta.id }}</td>
              <td>{{ formatearFecha(venta.fecha) }}</td>
              <td>
                <a *ngIf="venta.cliente !== 'An칩nimo'" [href]="'mailto:' + venta.cliente">
                  {{ venta.cliente }}
                </a>
              </td>
              <td>{{ venta.plan }}</td>
              <td>{{ formatearMonto(venta.monto) }}</td>
              <td>{{ venta.metodo }}</td>
              <td>
                <span class="badge bg-success">{{ venta.estado }}</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="mt-3">
        <p class="fw-bold">Total de transacciones: {{ ventas.length }}</p>
        <p class="fw-bold">
         Ingresos totales: {{ formatearMonto(totalIngresos) }}
        </p>
      </div>
    </div>
  </div>
</div>

