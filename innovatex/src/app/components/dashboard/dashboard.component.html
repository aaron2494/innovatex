<div class="grafico-container">
  <div class="grafico-pastel">
    <canvas baseChart
      [data]="chartData"
      [type]="'pie'"
      [options]="chartOptions">
    </canvas>
  </div>
  <div class="grafico-descripcion">
    <h3>📊 Distribución de planes contratados</h3>
    <p>
      Este gráfico de torta refleja el porcentaje de clientes que han adquirido cada uno de nuestros planes: <strong>Básico</strong>, <strong>Profesional</strong> y <strong>Premium</strong>.
    </p>
    <p>
      Nos permite visualizar qué soluciones están siendo más demandadas, ayudándonos a enfocar nuestras estrategias y seguir innovando en función de las necesidades de nuestros clientes.
    </p>
  </div>
</div>

<div class="container mt-4">
  <button class="btn btn-primary mb-3" (click)="mostrarDashboard = !mostrarDashboard">
    {{ mostrarDashboard ? 'Ocultar Dashboard' : 'Mostrar Dashboard' }}
  </button>

  <div [@expansion]="mostrarDashboard ? 'visible' : 'oculto'">
    <div *ngIf="mostrarDashboard">
      <h2 class="mb-4">Dashboard de Pagos</h2>

      <div *ngIf="cargando" class="text-center">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">Cargando...</span>
        </div>
        <p>Cargando transacciones...</p>
      </div>

      <div *ngIf="error" class="alert alert-danger">
        {{ error }}
      </div>

      <div *ngIf="!cargando && ventas.length === 0 && !error" class="alert alert-info">
        No hay transacciones para mostrar.
      </div>

      <div *ngIf="ventas.length > 0">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>ID Transacción</th>
                <th>Fecha</th>
                <th>Cliente</th>
                <th>Plan</th>
                <th>Monto</th>
                <th>Método de Pago</th>
                <th>Estado</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let venta of ventas">
                <td>{{ venta.id }}</td>
                <td>{{ formatearFecha(venta.fecha) }}</td>
                <td>
                  <a *ngIf="venta.cliente !== 'Anónimo'" [href]="'mailto:' + venta.cliente">
                    {{ venta.cliente }}
                  </a>
                  <span *ngIf="venta.cliente === 'Anónimo'">Anónimo</span>
                </td>
                <td>{{ venta.plan }}</td>
                <td>{{ formatearMonto(venta.monto) }}</td>
                <td>{{ venta.metodo }}</td>
                <td>
                  <span class="badge bg-success">{{ venta.estado }}</span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="mt-3">
          <p class="fw-bold">Total de transacciones: {{ ventas.length }}</p>
          <p class="fw-bold">
            Ingresos totales: {{ formatearMonto(totalIngresos) }}
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

